<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <script src='//in.fw-cdn.com/31677810/851659.js' chat='true'></script>
</head>
<body>
    <h1>Register</h1>
    <div id="message"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded and parsed');
            
            const messageDiv = document.getElementById('message');

            // Debug fwcrm object
            console.log('fwcrm object:', window.fwcrm);

            if (typeof fwcrm !== 'undefined' && typeof fwcrm.identify === 'function') {
                console.log('fwcrm SDK is loaded and identify function is available!');

                // Test with hardcoded values
                const new_contact = {
                    "First name": "John",
                    "Last name": "Doe",
                    "Email": "john.doe@example.com",
                    "Alternate contact number": "98765432",
                    "company": {
                        "Name": "Example.com",
                        "Website": "www.example.com"
                    }
                };
                const identifier = "john.doe@example.com";

                console.log('Attempting to call fwcrm.identify with test data');
                messageDiv.textContent = "Processing your registration...";

                try {
                    fwcrm.identify(identifier, new_contact, function(response) {
                        console.log("Inside fwcrm.identify callback");
                        console.log("CRM Response received:", response);
                        if (response && response.success) {
                            console.log("Contact created successfully in CRM:", response);
                            messageDiv.textContent = "Registration successful!";
                            window.location.href = '/login'; // Redirect to login on success
                        } else {
                            console.error("Error creating contact in CRM:", response);
                            messageDiv.textContent = "Error occurred while creating contact.";
                        }
                    });
                } catch (error) {
                    console.error("Exception occurred while calling fwcrm.identify:", error);
                    messageDiv.textContent = "An error occurred. Please try again.";
                }
                console.log("End of form submission handler");
            } else {
                console.error('fwcrm SDK is not loaded or identify function is unavailable.');
                messageDiv.textContent = "Error: CRM SDK not available.";
            }
        });
    </script>
</body>
</html>
