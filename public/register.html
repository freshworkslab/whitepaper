<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <script src='//in.fw-cdn.com/31677810/851659.js' chat='true'></script>
</head>
<body>
    <!-- ... (previous HTML remains the same) ... -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded and parsed');
            
            if (typeof fwcrm !== 'undefined' && typeof fwcrm.identify === 'function') {
                console.log('fwcrm SDK is loaded and identify function is available!');

                document.getElementById('registerForm').addEventListener('submit', function(event) {
                    console.log('Form submission event triggered');
                    event.preventDefault();

                    const firstName = document.getElementById('firstName').value;
                    const lastName = document.getElementById('lastName').value;
                    const email = document.getElementById('email').value;
                    const companyName = document.getElementById('companyName').value;
                    const companyWebsite = document.getElementById('companyWebsite').value;

                    console.log('Form data captured:', { firstName, lastName, email, companyName, companyWebsite });

                    const new_contact = {
                        "FirstName": firstName,
                        "LastName": lastName,
                        "Email": email,
                        "company": {
                            "Name": companyName,
                            "Website": companyWebsite
                        }
                    };

                    const identifier = email;

                    console.log('Attempting to call fwcrm.identify');
                    try {
                        fwcrm.identify(identifier, new_contact, function(response) {
                            console.log("Inside fwcrm.identify callback");
                            console.log("CRM Response received:", response);

                            if (response && response.success) {
                                console.log("Contact created successfully in CRM:", response);
                                console.log("Registration successful. Redirection removed for debugging.");
                            } else {
                                console.error("Error creating contact in CRM:", response);
                                alert("Error occurred while creating contact.");
                            }
                        });
                        console.log("fwcrm.identify call completed");
                    } catch (error) {
                        console.error("Exception occurred while calling fwcrm.identify:", error);
                        alert("An error occurred. Please try again.");
                    }
                    console.log("End of form submission handler");
                });
            } else {
                console.error('fwcrm SDK is not loaded or identify function is unavailable.');
                alert("Error: CRM SDK not available.");
            }
        });
    </script>
</body>
</html>
